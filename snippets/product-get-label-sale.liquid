{%- assign min_price = price -%}
{%- assign min_compare_at_price = compare_at_price -%}

{%- if product.variants.size > 1 -%}
  {%- # まず最安値のバリエーションを見つける -%}
  {%- assign min_price = product.price_min -%}
  
  {%- # 最安値のバリエーションとそのcompare_at_priceを取得 -%}
  {%- for variant in product.variants -%}
    {%- if variant.price == min_price -%}
      {%- assign min_compare_at_price = variant.compare_at_price -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{%- # 最安値バリエーションのセール表示判定 -%}
{%- if min_compare_at_price > min_price and min_compare_at_price != blank -%}
  {%- assign sale_percent = min_price | times: 100 | divided_by: min_compare_at_price | minus: 100 | times: -1 -%}
  <div class="label label--sale mb-3 mr-3 text-nowrap" data-js-product-label-sale>
    {{ 'products.product.label.sale' | t: percent: sale_percent }}
  </div>
  {%- assign has_labels = true -%}
{%- else -%}
  <div class="label label--sale mb-3 mr-3 text-nowrap d-none-important" data-js-product-label-sale></div>
{%- endif -%}